version: '3.8'
networks: 
  private:
    external:
      name: private
  web:
    external: 
      name: web
volumes:
  mysql-data:
  postgres_data:
    driver: local
 
services:
      
#---------------------
# api
#---------------------
  api-prod:
    build:
      context: .
      args:
        - PATH_OF_WAR=${PATH_OF_WAR}
    image: ${ENV}-api
    container_name: ${ENV}-api
    depends_on:
      - mysql
    environment:
      spring.datasource.username: ${MYSQL_USERNAME}
      spring.datasource.password: ${MYSQL_ROOT_PASSWORD}
      spring.profiles.active: ${ENV}
      spring.datasource.url: jdbc:mysql://mysql:3306/${MYSQL_DATABASE}?serverTimezone=Europe/Berlin
      server.port: 80
    labels:
      - traefik.enable=true
      - "traefik.http.routers.docker-api.entrypoints=websecure"
      - traefik.http.routers.docker-api.rule=Host(`${SUB_DOMAIN}.dsp4-5archio19-ah-je-gh-yb.fr`)
      - traefik.http.services.docker-api.loadbalancer.server.port=80
      - "traefik.http.routers.docker-api.tls.certresolver=lets-encr"
      #prochaine ligne est peut etre inutile
      - traefik.http.routers.docker-api.middlewares=corsheaders
    networks: 
      - private
      - web
      
      
      